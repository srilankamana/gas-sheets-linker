# **2つのスプレッドシートを連携するステータス自動化スクリプト**

これは、Google Apps Script (GAS) を利用して、2つの異なるGoogleスプレッドシート間のステータス更新とフィルタ適用を自動化するプロジェクトです。

## **概要**

候補者情報を管理する「一覧シート」と、企業側の「進捗管理シート」の2つのスプレッドシートが存在していました。

「一覧シート」で推薦が完了した際（特定の列に日付が入力された時）、従来は手作業で「進捗管理シート」を開き、該当する候補者のステータスを「完了」に更新し、さらにフィルタをかけて非表示にする、という手間が発生していました。

このスクリプトは、その一連の作業を完全に自動化します。

## **主な機能**

* **編集トリガー:** 「一覧シート」の特定列（例: "推薦済みフラグ"列）が編集されると、自動でスクリプトが起動します。  
* **シート間連携:** openById() を使用し、「一覧シート」の特定列に記載されたIDを元に、別ファイルである「進捗管理シート」を開きます。  
* **自動ステータス更新:** 「推薦URL」と「候補者名」の2つをユニークキーとして照合し、一致した行のステータスを自動で「完了」（例: "推薦済"）に更新します。  
* **自動フィルタ適用:** ステータス更新後、完了した行が非表示になるようフィルタを自動で再適用します。既存の「表」機能と競合しない安全なロジックを実装しています。  
* **保守性の高い設計:** 列番号（17など）ではなく、列名（推薦済みフラグなど）で列を特定する仕組みを実装しました。これにより、スプレッドシート側で列の順番を入れ替えてもスクリプトが壊れません。

## **このプロジェクトのポイント（苦労した点と工夫）**

このスクリプトの開発では、単に処理を自動化するだけでなく、実際の業務で発生する様々な課題に直面し、解決しました。

* **工夫1: 列の移動に強い設計（保守性）**  
  * 当初は列番号（A列=1, B列=2...）で指定していましたが、シートのレイアウト変更に弱いという課題がありました。  
  * **解決策:** ヘッダー行から「列名」を検索して列番号を動的に取得する関数 (getColumnNumbersByName) を実装しました。これにより、ユーザーが列を移動したり挿入したりしても、コードを修正することなく動作し続けます。  
* **課題2: データの不一致（タイムゾーン問題）**  
  * 当初は「推薦日時」をキーに照合しようとしましたが、2つのシート間で日時のタイムゾーン（JSTとUTC）が9時間ズレており、正しく一致しませんでした。  
  * **解決策:** 日時に依存しない、より信頼性の高い「推薦URL」と「候補者名」の2つの文字列をキーとして照合するロジックに変更し、問題を根本的に解決しました。  
* **課題3: フィルタと「表」機能の競合**  
  * 連携先シートに「表（交互の背景色など）」が設定されている場合、スクリプトからフィルタを新規作成しようとするとエラーが発生しました。  
  * **解決策:** 「フィルタを削除して作り直す」のではなく、「既にフィルタが存在するか確認し、存在する場合はルールだけを更新する」というロジックに変更することで、既存のシート設定を壊さずに自動化を実現しました。  
* **課題4: セキュリティ制限**  
  * onEdit(e) という単純なトリガーでは、セキュリティ制限により openById()（他のスプレッドシートを開く）が実行できないことが判明しました。  
  * **解決策:** インストール型トリガーを利用する設計に変更し、スクリプトに必要な権限を与え、自動実行を実現しました。
