# **2つのスプレッドシートを連携するステータス自動化スクリプト**

これは、Google Apps Script (GAS) を利用して、2つの異なるGoogleスプレッドシート間のステータス更新とフィルタ適用を自動化するプロジェクトです。

## **概要**

候補者情報を管理する「一覧シート」と、企業側の「進捗管理シート」の2つのスプレッドシートが存在していました。

「一覧シート」で推薦が完了した際（特定の列に日付が入力された時）、従来は手作業で「進捗管理シート」を開き、該当する候補者のステータスを「完了」に更新し、さらにフィルタをかけて非表示にする、という手間が発生していました。

このスクリプトは、その一連の作業を完全に自動化します。

## **主な機能**

* **編集トリガー:** 「一覧シート」の特定列（例: Q列）が編集されると、自動でスクリプトが起動します。  
* **シート間連携:** openById() を使用し、「一覧シート」の特定列（例: K列）に記載されたIDを元に、別ファイルである「進捗管理シート」を開きます。  
* **自動ステータス更新:** 「推薦URL」と「候補者名」の2つをユニークキーとして照合し、一致した行のステータスを自動で「完了」（例: "推薦済"）に更新します。  
* **自動フィルタ適用:** ステータス更新後、applyFilterToHideCompleted 関数が実行され、完了した行が非表示になるようフィルタを自動で再適用します。

  ## **このプロジェクトのポイント（苦労した点）**

  このスクリプトの開発では、単に処理を自動化するだけでなく、実際の業務で発生する様々な課題に直面しました。  
* **課題1: データの不一致（タイムゾーン問題）**  
  * 当初は「推薦日時」をキーに照合しようとしましたが、2つのシート間で日時のタイムゾーン（JSTとUTC）が9時間ズレており、正しく一致しませんでした。  
  * **解決策:** 日時に依存しない、より信頼性の高い「推薦URL」と「候補者名」の2つの文字列をキーとして照合するロジックに変更し、問題を根本的に解決しました。  
* **課題2: フィルタのタイミング問題**  
  * スクリプトがステータスを「推薦済」に書き込んだ直後にフィルタを適用しても、スプレッドシート側の反映が間に合わず、非表示にならない問題が発生しました。  
  * **解決策:** SpreadsheetApp.flush() を挟んで変更を強制反映させ、さらにフィルタの適用ロジックを「ルールだけを更新する」のではなく、「一度フィルタを削除し、再作成する」という最もシンプルな方法に変更することで、確実にフィルタが再適用されるようにしました。  
* **課題3: セキュリティ制限（トリガーの仕様）**  
  * onEdit(e) という単純なトリガーでは、セキュリティ制限により openById()（他のスプレッドシートを開く）が実行できないことが判明しました。  
  * **解決策:** 関数名を myOnEditTrigger(e) に変更し、手動で「インストール型トリガー」を設定することで、スクリプトに必要な権限を与え、自動実行を実現しました。
